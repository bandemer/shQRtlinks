{% extends 'base.html.twig' %}

{% block body %}
<div class="d-flex flex-column vh-100">

	{% include 'navbar.html.twig' %}

	<div class="container py-5">

		<h2 class="d-flex my-3">
			Your Short Links <a class="btn btn-primary ms-auto me-2" href="{{ url('links_new') }}">
				<i class="bi-plus-circle mx-1"></i> Add new Link</a>
		</h2>
		<hr class="my-4 mb-xl-5">

		{% for message in app.flashes('notice') %}
			<div class="alert alert-success alert-dismissible fade show mb-3" role="alert">
				{{ message }}
				<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
			</div>
		{% endfor %}
		{% for message in app.flashes('error') %}
			<div class="alert alert-danger alert-dismissible fade show mb-3" role="alert">
				{{ message }}
				<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
			</div>
		{% endfor %}

		<table class="table table-striped table-hover my-4">
			<thead>
				<tr>
					<th class="p-3 text-center">ID</th>
					<th class="p-3 text-center">State</th>
					<th class="p-3">Alias</th>
					<th class="p-3">Destination URL</th>
					<th class="p-3 text-center">Clicks</th>
					<th class="p-3 text-center">Action</th>
				</tr>
			</thead>
			<tbody>
			{% if links|length == 0 %}
				<tr>
					<td colspan="6" class="p-4 p-lg-5 text-center bg-light">
						<h3 class="h4 text-muted"><i class="bi bi-emoji-frown"></i>
							Unfortunately, no links were found.</h3>
					</td>
				</tr>
			{% endif %}

			{% for l in links %}
				<tr>
					<td class="text-center">{{ l.id }}</td>
					<td class="text-center">
						<a href="#" onclick="changeStatus('{{ url('links_changestatus') }}', {{ l.id }}, '{{ csrf_token('links-changestatus') }}')"><i id="linkstatus{{ l.id }}" class="bi-circle-fill text-{% if l.status == 0 %}danger{% else %}success{% endif %}"></i></a>
					</td>
					<td class="px-3"><a href="{{ url('shortlink', { alias: l.alias }) }}" target="_blank" rel="noopener">{{ l.alias }}</a></td>
					<td class="px-3"><a href="{{ l.url }}" target="_blank" rel="noopener">{{ l.url }}</a></td>
					<td class="text-center">{{ l.clicks }}</td>
					<td class="d-flex justify-content-center">
						<form action="{{ url('links_delete') }}" method="post" class="me-3">
							<input type="hidden" name="token" value="{{ csrf_token('links-delete') }}"/>
							<input type="hidden" name="linkid" value="{{ l.id }}"/>
							<button type="submit" title="Delete" class="btn btn-light border">
								<i class="bi-trash-fill mx-1"></i> Delete
							</button>
						</form>
						<form action="{{ url('links_edit') }}" method="post" class="me-3">
							<input type="hidden" name="token" value="{{ csrf_token('links-edit') }}"/>
							<input type="hidden" name="linkid" value="{{ l.id }}"/>
							<button type="submit" title="Edit" class="btn btn-light border">
								<i class="bi-pencil-fill mx-1"></i> Edit
							</button>
						</form>
					</td>
				</tr>
			{% endfor %}
			</tbody>
		</table>
	</div>
	{% include 'footer.html.twig' %}

</div>
{% endblock %}